------------
Usage
------------



Docker
------

.. _Dockerhub : https://hub.docker.com/r/neurodata/m2g/
.. _documentation : https://docs.docker.com/

In order to share data between our container and the rest of our machine in Docker, we need to mount a volume.
Docker does this with the -v flag. Docker expects its input formatted as: ``-v path/to/local/data:/path/in/container``.
We'll do this when we launch our container, as well as give it a helpful name so we can locate it later on.

The neurodata/m3r-release Docker container enables users to run end-to-end connectome estimation on structural MRI or functional MRI right from container launch. The pipeline requires that data be organized in accordance with the BIDS spec. If the data you wish to process is available on S3 you simply need to provide your s3 credentials at build time and the pipeline will auto-retrieve your data for processing.

If you have never used Docker before, it is useful to run through the Docker documentation_.

**Getting Docker container**::

    $ docker pull neurodata/m2g

*(A) I do not wish to use S3:*

You are good to go!

*(B) I wish to use S3:*

Add your secret key/access id to a file called credentials.csv in this directory on your local machine. A dummy file has been provided to make the format we expect clear. (This is how AWS provides credentials)


Command-Line Arguments
----------------------

Below is the help output generated by running **m2g** with the ``-h`` command. All parameters are explained in this output. ::

    $ docker run -ti neurodata/m2g -h

    usage: m2g_bids [-h]
                 [--participant_label PARTICIPANT_LABEL [PARTICIPANT_LABEL ...]]
                 [--session_label SESSION_LABEL [SESSION_LABEL ...]]
                 [--run_label RUN_LABEL [RUN_LABEL ...]] [--bucket BUCKET]
                 [--remote_path REMOTE_PATH] [--push_data] [--dataset DATASET]
                 [--atlas ATLAS] [--debug] [--sked] [--skreg] [--vox VOX] [-c]
                 [--mod MOD] [--tt TT] [--mf MF] [--sp SP] [--seeds SEEDS]
                 [--modif MODIF]
                 bids_dir output_dir

    This is an end-to-end connectome estimation pipeline from M3r Images.

    positional arguments:
    bids_dir              The directory with the input dataset formatted
                          according to the BIDS standard.
    output_dir            The directory where the output files should be stored.
                          If you are running group level analysis this folder
                          should be prepopulated with the results of the
                          participant level analysis.

    optional arguments:
    -h, --help            show this help message and exit
    --participant_label PARTICIPANT_LABEL [PARTICIPANT_LABEL ...]
                          The label(s) of the participant(s) that should be
                          analyzed. The label corresponds to
                          sub-<participant_label> from the BIDS spec (so it does
                          not include "sub-"). If this parameter is not provided
                          all subjects should be analyzed. Multiple participants
                          can be specified with a space separated list.
    --session_label SESSION_LABEL [SESSION_LABEL ...]
                          The label(s) of the session that should be analyzed.
                          The label corresponds to ses-<participant_label> from
                          the BIDS spec (so it does not include "ses-"). If this
                          parameter is not provided all sessions should be
                          analyzed. Multiple sessions can be specified with a
                          space separated list.
    --run_label RUN_LABEL [RUN_LABEL ...]
                          The label(s) of the run that should be analyzed. The
                          label corresponds to run-<run_label> from the BIDS
                          spec (so it does not include "task-"). If this
                          parameter is not provided all runs should be analyzed.
                          Multiple runs can be specified with a space separated
                          list.
    --bucket BUCKET       The name of an S3 bucket which holds BIDS organized
                          data. You must have built your bucket with credentials
                          to the S3 bucket you wish to access.
    --remote_path REMOTE_PATH
                          The path to the data on your S3 bucket. The data will
                          be downloaded to the provided bids_dir on your
                          machine.
    --push_data           flag to push derivatives back up to S3.
    --dataset DATASET     The name of the dataset you are perfoming QC on.
    --atlas ATLAS         The atlas being analyzed in QC (if you only want one).
    --debug               If False, remove any old files in the output
                          directory.
    --sked                Whether to skip eddy correction if it has already been
                          run.
    --skreg               whether or not to skip registration
    --vox VOX             Voxel size to use for template registrations (e.g.
                          default is '2mm')
    -c, --clean           Whether or not to delete intemediates
    --mod MOD             Determinstic (det) or probabilistic (prob) tracking.
                          Default is det.
    --tt TT               Tracking approach: local or particle. Default is
                        local.
    --mf MF               Diffusion model: csd or csa. Default is csd.
    --sp SP               Space for tractography. Default is native.
    --seeds SEEDS         Seeding density for tractography. Default is 20.
    --modif MODIF         Name of folder on s3 to push to. If empty, push to a
                          folder with m2g's version number.
